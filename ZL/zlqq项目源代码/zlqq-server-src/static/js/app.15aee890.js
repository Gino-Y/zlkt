(function(e){function t(t){for(var o,s,a=t[0],i=t[1],u=t[2],d=0,f=[];d<a.length;d++)s=a[d],Object.prototype.hasOwnProperty.call(r,s)&&r[s]&&f.push(r[s][0]),r[s]=0;for(o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o]);l&&l(t);while(f.length)f.shift()();return c.push.apply(c,u||[]),n()}function n(){for(var e,t=0;t<c.length;t++){for(var n=c[t],o=!0,a=1;a<n.length;a++){var i=n[a];0!==r[i]&&(o=!1)}o&&(c.splice(t--,1),e=s(s.s=n[0]))}return e}var o={},r={app:0},c=[];function s(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=o,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)s.d(n,o,function(t){return e[t]}.bind(null,o));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/static/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],i=a.push.bind(a);a.push=t,a=a.slice();for(var u=0;u<a.length;u++)t(a[u]);var l=i;c.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0c23":function(e,t,n){},"121e":function(e,t,n){},"14bf":function(e,t,n){"use strict";n("121e")},2705:function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("7a23");function r(e,t,n,r,c,s){var a=Object(o["resolveComponent"])("router-view");return Object(o["openBlock"])(),Object(o["createBlock"])(a)}var c={name:"App"},s=(n("5f93"),n("6b0d")),a=n.n(s);const i=a()(c,[["render",r]]);var u=i,l=n("6c02"),d=function(e){return Object(o["pushScopeId"])("data-v-04a69018"),e=e(),Object(o["popScopeId"])(),e},f=d((function(){return Object(o["createElementVNode"])("h1",{style:{"text-align":"center",padding:"10px"}},"知了传课在线聊天系统",-1)})),m={class:"home-container"},b={class:"sidebar"},p={class:"main"};function O(e,t,n,r,c,s){var a=Object(o["resolveComponent"])("card"),i=Object(o["resolveComponent"])("list"),u=Object(o["resolveComponent"])("message"),l=Object(o["resolveComponent"])("chat-text");return Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],null,[f,Object(o["createElementVNode"])("div",m,[e.$store.state.user?(Object(o["openBlock"])(),Object(o["createElementBlock"])(o["Fragment"],{key:0},[Object(o["createElementVNode"])("div",b,[Object(o["createVNode"])(a),Object(o["createVNode"])(i)]),Object(o["createElementVNode"])("div",p,[Object(o["createVNode"])(u),Object(o["createVNode"])(l)])],64)):Object(o["createCommentVNode"])("",!0)])],64)}var v=n("ade3"),h=(n("b0c0"),{class:"card"}),j=["src"],g={class:"name"};function E(e,t,n,r,c,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",h,[Object(o["createElementVNode"])("header",null,[Object(o["createElementVNode"])("img",{class:"avatar",width:"40",height:"40",alt:"周杰伦",src:e.$socket.server_host+s.user.avatar},null,8,j),Object(o["createElementVNode"])("p",g,Object(o["toDisplayString"])(s.user.username),1)])])}var k={name:"card",computed:{user:function(){return this.$store.state.user}}};n("14bf");const S=a()(k,[["render",E],["__scopeId","data-v-57ec9d4c"]]);var _=S,y={class:"list"},N=["onClick"],V=["alt","src"],$={class:"name"};function C(e,t,n,r,c,s){var a=Object(o["resolveComponent"])("el-badge");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",y,[Object(o["createElementVNode"])("ul",null,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(s.sessions,(function(t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{onClick:function(e){return s.onSelectSession(t)},class:Object(o["normalizeClass"])({active:s.current_session&&t.user.sid==s.current_session.user.sid}),key:t.user.sid},[Object(o["createElementVNode"])("img",{class:"avatar",width:"30",height:"30",alt:t.user.username,src:e.$socket.server_host+t.user.avatar},null,8,V),Object(o["createVNode"])(a,{value:t.unread,class:"item",hidden:0==t.unread},{default:Object(o["withCtx"])((function(){return[Object(o["createElementVNode"])("p",$,Object(o["toDisplayString"])(t.user.username)+"("+Object(o["toDisplayString"])(t.user.ip)+")",1)]})),_:2},1032,["value","hidden"])],10,N)})),128))])])}var w={name:"list",computed:{sessions:function(){return this.$store.state.sessions},current_session:function(){return this.$store.state.current_session}},mounted:function(){var e=this;this.$socket.onFriendOnline((function(t){var n=t.user;e.$store.commit("ADD_SESSION",n)})),this.$socket.onFriendOffline((function(t){var n=t.user;e.$store.commit("DELETE_SESSION",n)}))},methods:{onSelectSession:function(e){this.$store.commit("SET_CURRENT_SESSION",e)}}};n("ab9e");const B=a()(w,[["render",C],["__scopeId","data-v-77b8192c"]]);var x=B,I={class:"text"};function D(e,t,n,r,c,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",I,[Object(o["withDirectives"])(Object(o["createElementVNode"])("textarea",{placeholder:"按 Ctrl + Enter 发送","onUpdate:modelValue":t[0]||(t[0]=function(e){return c.content=e}),onKeyup:t[1]||(t[1]=function(){return s.onKeyup&&s.onKeyup.apply(s,arguments)})},null,544),[[o["vModelText"],c.content]])])}var T=n("3ef4"),M={name:"chat-text",computed:{current_session:function(){return this.$store.state.current_session}},data:function(){return{content:""}},methods:{onKeyup:function(e){var t=this;if(e.ctrlKey&&13===e.keyCode&&this.content.length){if(!this.current_session)return void T["a"].info("请先选中聊天对象！");var n=this.content;this.$socket.emitSendMessage({to:this.current_session.user.sid,message:this.content},(function(e){200==e["code"]&&t.$store.commit("SEND_MESSAGE",n)})),this.content=""}}}};n("c44a");const F=a()(M,[["render",D],["__scopeId","data-v-29584aef"]]);var R=F,A={class:"message",ref:"el"},P={key:0},L={class:"time"},U=["src"],K={class:"text"};function G(e,t,n,r,c,s){return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",A,[s.current_session?(Object(o["openBlock"])(),Object(o["createElementBlock"])("ul",P,[(Object(o["openBlock"])(!0),Object(o["createElementBlock"])(o["Fragment"],null,Object(o["renderList"])(s.current_session.messages,(function(e,t){return Object(o["openBlock"])(),Object(o["createElementBlock"])("li",{key:t},[Object(o["createElementVNode"])("p",L,[Object(o["createElementVNode"])("span",null,Object(o["toDisplayString"])(s.timeFormat(e.date)),1)]),Object(o["createElementVNode"])("div",{class:Object(o["normalizeClass"])({main:!0,self:e.self})},[Object(o["createElementVNode"])("img",{class:"avatar",width:"30",height:"30",src:e.self?s.avatarFormat(s.user.avatar):s.avatarFormat(s.current_session.user.avatar)},null,8,U),Object(o["createElementVNode"])("div",K,Object(o["toDisplayString"])(e.content),1)],2)])})),128))])):Object(o["createCommentVNode"])("",!0)],512)}var H={computed:{current_session:function(){return this.$store.state.current_session},user:function(){return this.$store.state.user}},mounted:function(){var e=this;this.$socket.onReceiveMessage((function(t){var n=t["from"],o=t["message"];e.$store.commit("RECEIVE_MESSAGE",{sid:n,content:o})}))},methods:{timeFormat:function(e){return"string"===typeof e&&(e=new Date(e)),e.getHours()+":"+e.getMinutes()},avatarFormat:function(e){return this.$socket.server_host+e}},updated:function(){var e=this;this.$nextTick((function(){var t=e.$refs.el;t.scrollTop=t.scrollHeight}))}};n("b6d6");const z=a()(H,[["render",G],["__scopeId","data-v-e1b8a286"]]);var J,q=z,Q={name:"Home",created:function(){},mounted:function(){this.$store.getters.logined||this.$router.push({name:"login"})},components:(J={card:_,list:x},Object(v["a"])(J,R.name,R),Object(v["a"])(J,"message",q),J)};n("f0d3"),n("acfc");const W=a()(Q,[["render",O],["__scopeId","data-v-04a69018"]]);var X=W,Y=function(e){return Object(o["pushScopeId"])("data-v-c2c5d27a"),e=e(),Object(o["popScopeId"])(),e},Z={class:"login-container"},ee=Y((function(){return Object(o["createElementVNode"])("h1",{style:{"text-align":"center"}},"知了在线聊天系统",-1)})),te=Object(o["createTextVNode"])("登录");function ne(e,t,n,r,c,s){var a=Object(o["resolveComponent"])("el-input"),i=Object(o["resolveComponent"])("el-form-item"),u=Object(o["resolveComponent"])("el-button"),l=Object(o["resolveComponent"])("el-form");return Object(o["openBlock"])(),Object(o["createElementBlock"])("div",Z,[Object(o["createVNode"])(l,{ref:"form",model:c.form,class:"login-main"},{default:Object(o["withCtx"])((function(){return[ee,Object(o["createVNode"])(i,null,{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(a,{modelValue:c.form.username,"onUpdate:modelValue":t[0]||(t[0]=function(e){return c.form.username=e}),placeholder:"请输入用户名"},null,8,["modelValue"])]})),_:1}),Object(o["createVNode"])(i,{style:{"text-align":"right"}},{default:Object(o["withCtx"])((function(){return[Object(o["createVNode"])(u,{type:"primary",onClick:s.onSubmit},{default:Object(o["withCtx"])((function(){return[te]})),_:1},8,["onClick"])]})),_:1})]})),_:1},8,["model"])])}var oe={name:"Login",data:function(){return{form:{username:""}}},mounted:function(){},methods:{onSubmit:function(){var e=this;this.form.username?(this.$socket.connected||this.$socket.connect(),this.$socket.emitLogin(this.form.username,(function(t){if(200===t["code"]){var n=t["data"],o=n["user"],r=n["online_users"];e.$store.commit("SET_SESSIONS",r),e.$store.commit("SET_USER",o),e.$router.push({name:"home"})}else T["a"].error(t["message"])}))):T["a"].error("请输入用户名！")}}};n("6b96");const re=a()(oe,[["render",ne],["__scopeId","data-v-c2c5d27a"]]);var ce=re,se=[{path:"/",component:X,name:"home"},{path:"/login",component:ce,name:"login"}],ae=Object(l["a"])({history:Object(l["b"])(),routes:se}),ie=ae,ue=n("b85c"),le=(n("a434"),n("5502")),de=Object(le["a"])({state:{user:null,sessions:[],current_session:null},mutations:{SET_USER:function(e,t){e.user=t},ADD_SESSION:function(e,t){e.sessions.push({user:t,messages:[],unread:0})},DELETE_SESSION:function(e,t){for(var n=0;n<e.sessions.length;n++){var o=e.sessions[n];if(o.user.sid==t.sid){e.sessions.splice(n,1),e.current_session.user.sid==o.user.sid&&(e.current_session=null);break}}},SET_SESSIONS:function(e,t){var n,o=[],r=Object(ue["a"])(t);try{for(r.s();!(n=r.n()).done;){var c=n.value;o.push({user:c,messages:[],unread:0})}}catch(s){r.e(s)}finally{r.f()}e.sessions=o},SET_CURRENT_SESSION:function(e,t){t.unread=0,e.current_session=t},SEND_MESSAGE:function(e,t){e.current_session&&e.current_session.messages.push({content:t,date:new Date,self:!0})},RECEIVE_MESSAGE:function(e,t){var n,o=t["sid"],r=t["content"],c=null,s=Object(ue["a"])(e.sessions);try{for(s.s();!(n=s.n()).done;){var a=n.value;if(a.user.sid==o){c=a;break}}}catch(i){s.e(i)}finally{s.f()}c&&(c.messages.push({content:r,date:new Date,self:!1}),e.current_session&&e.current_session.user.sid==c.user.sid||(c.unread+=1))}},getters:{logined:function(e){return!!e.user}}}),fe=de,me=n("c3a1"),be=(n("7437"),n("d4ec")),pe=n("bee2"),Oe=n("daa8"),ve=function(){function e(){Object(be["a"])(this,e),this.server_host=window.location.origin,this.socket=Object(Oe["a"])(this.server_host)}return Object(pe["a"])(e,[{key:"connect",value:function(){this.socket.connect()}},{key:"emitLogin",value:function(e,t){this.socket.emit("login",{username:e},(function(e){t&&t(e)}))}},{key:"onFriendOnline",value:function(e){this.socket.on("friend online",(function(t){e&&e(t)}))}},{key:"onFriendOffline",value:function(e){this.socket.on("friend offline",(function(t){e&&e(t)}))}},{key:"emitSendMessage",value:function(e,t){this.socket.emit("send message",{to:e["to"],message:e["message"]},(function(e){t&&t(e)}))}},{key:"onReceiveMessage",value:function(e){this.socket.on("receive message",(function(t){e&&e(t)}))}},{key:"connected",get:function(){return this.socket.connected}}]),e}(),he=new ve,je=Object(o["createApp"])(u);je.use(ie),je.use(fe),je.use(me["a"]),je.config.globalProperties.$socket=he,je.mount("#app")},"5f93":function(e,t,n){"use strict";n("63e0")},"609a":function(e,t,n){},"63e0":function(e,t,n){},"6b96":function(e,t,n){"use strict";n("2705")},ab9e:function(e,t,n){"use strict";n("b17a")},acfc:function(e,t,n){"use strict";n("0c23")},b17a:function(e,t,n){},b6d6:function(e,t,n){"use strict";n("e56e")},c44a:function(e,t,n){"use strict";n("609a")},e56e:function(e,t,n){},ea28:function(e,t,n){},f0d3:function(e,t,n){"use strict";n("ea28")}});